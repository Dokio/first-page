### relativeTime

#### **接口定义**1——relativeTime传入参数

```typescript
interface RelativeTimeProps {
  setTimeValue: React.Dispatch<React.SetStateAction<any[]>>
}
```



#### **接口定义2**——relativeTime传入参数

```typescript
inerface RelativeTimeElementProps{
    relativeTimeLabel: string;
    relativelabelChecked: boolean;
    timeScale:string;
    timeValue: numhber;
}
```

#### **初始化——选择范围**

relativeTimeLabel的选择是有范围的，所以定义一个enum

timeScale的选择是有范围的，所以定义一个enum

```typescript
enum relativeTimeLabelsList {
  lastFiveMinutes = 'Last 5 minites',
  lastThirtyMinutes = 'Last 30 minites',
  lastOneHour = 'Last 1 hours',
  lastThreeHours = 'Last 3 hours',
  lastSixHours = 'Last 6 hours',
  lastTwelveHours = 'Last 12 hours',
  lastTwentyFourHours = 'Last 24 hours',
}

enum RelativeTimeScale {
    timeMinute = "minute"
    timeHour = "hour"
}
```

#### **初始化——list**

```typescript
const [relativeTimeList, setRelativeTimeList] = useState<RelativeTimeElementProps[]>([
    {
      relativeTimeLabel: relativeTimeLabelsList['lastFiveMinutes'],
      relativelabelChecked: false,
      timeScale:RelativeTimeScale['timeMinute'],
      timeValue: 5
    },
    {
      relativeTimeLabel: relativeTimeLabelsList['lastThirtyMinutes'],
      relativelabelChecked: false,
      timeScale:RelativeTimeScale['timeMinute'],
      timeValue: 30
    },
    {
      relativeTimeLabel: relativeTimeLabelsList['lastOneHour'],
      relativelabelChecked: false,
      timeScale:RelativeTimeScale['timeHour'],
      timeValue: 1
    },
    {
      relativeTimeLabel: relativeTimeLabelsList['lastThreeHours'],
      relativelabelChecked: false,
      timeScale:RelativeTimeScale['timeHour'],
      timeValue: 3 
    },
    {
      relativeTimeLabel: relativeTimeLabelsList['lastSixHours'],
      relativelabelChecked: false,
      timeScale:RelativeTimeScale['timeHour'],
      timeValue: 6
    },
    {
      relativeTimeLabel: relativeTimeLabelsList['lastTwelveHours'],
      relativelabelChecked: false,
      timeScale:RelativeTimeScale['timeHour'],
      timeValue: 12
    },
    {
      relativeTimeLabel: relativeTimeLabelsList['lastTwentyFourHours'],
      relativelabelChecked: false,
      timeScale:RelativeTimeScale['timeHour'],
      timeValue: 24
    },
  ]);
```

#### 生成元素

```typescript
 <div className={style['relative-time']}>
        <span>Relative Time Range</span>
        {
          relativeTimeList.map((relativeTimeElement) =>
            <span
              key={relativeTimeElement.relativeTimeLabel}
              onClick={() => handleSelectRelativeTime(relativeTimeElement)}
              className={relativeTimeElement.relativelabelChecked ? style.checked : ''}
            >
              {relativeTimeElement.relativeTimeLabel}
            </span>
          )
        }
 </div>
```



#### 两个点击事件的响应——统一写在一个函数里面

##### **响应包括**

**1.变色：**

- 让relative time中选中的时间变色

- 让recent time所有的时间都变暗

**2.让输入框显示的值为我们选中的值**

**3.将选中的值存储到local session中**

```typescript
onClick={() => handleSelectRelativeTime(relativeTimeElement)}

const handleSelectRelativeTime = (relativeTimeElement：RelativeTimeElementProps) => {
    //变色1:让relative time中选中的时间变色
     setRelativeTimeList(
      relativeTimeList.map((relativeTimeItem) => {
        return {
          ...relativeTimeItem,
          relativelabelChecked: relativeTimeItem.relativeTimeLabel === relativeTimeElement.relativeTimeLabel,
        };
      })
    )
    //变色2： 让recent time所有的时间都变暗
    
    //点击事件响应，包括：
    //1.让输入框显示的值为我们选中的值, setTimeValue函数是从父组件传过来的
    setTimeValue([moment().subtract(relativeTimeElement.timeValue, relativeTimeElement.timeScale), moment()]);
    //2.将选中的值存储到local session中
    updateHistoryOnLocalSession(relativeTimeElement)
}
```



##### 函数：将选中的值存储到local session中

输入：RelativeTimeElementProps的实例

输出：void

```typescript
const updateHistoryOnLocalSession (relativeTimeElement：RelativeTimeElementProps) =>{
	//得到选中的时间范围
    const selectedTime: string = JSON.stringify([moment().subtract(relativeTimeElement.value, relativeTimeElement.level), moment()])

    //得到loca session中存储的历史时间列表
    //[
    //	"[\"2021-06-06T04:34:07.766Z\",\"2021-06-06T04:39:07.766Z\"]",
    //	"[\"2021-06-05T04:39:07.290Z\",\"2021-06-06T04:39:07.290Z\"]",
    //  "[\"2021-05-17T04:39:06.792Z\",\"2021-06-06T04:39:06.792Z\"]"
    //]
    const currentHistoryList: string[];
    if (localStorage.getItem('history_time_list')){
        currentHistoryList = JSON.parse(localStorage.getItem('history_time_list')
    } else {
        currentHistoryList = []                              
    }
    
    //将选中的时间范围，放入loca session中存储的历史时间列表中
    //1.当将选中的时间范围在列表中已经存在，那就将存在的值过滤掉，然后合并选中的时间和处理后的列表
    //2.当选中时间不存在，那就直接合并选中的时间和处理后的列表，然后做切片操作
    if (currentHistoryList.some(currentHistoryListElement => currentHistoryListElement=== selectedTime)){
        //filter:把满足条件的留下来
        currentHistoryList = currentHistoryList.filter(currentHistoryListElement => currentHistoryListElement != selectedTime)
        currentHistoryList = [selectedTime].concat(currentHistoryList)
    } else {
        currentHistoryList = [selectedTime].concat(currentHistoryList)
        currentHistoryList = currentHistoryList.slice(0, 3)
    }
    
    //最后更新local session
    localStorage.setItem('history_time_list', JSON.stringify(currentHistoryList))
}
```





### recentTime



#### 接口定义

```typescript
inerface RecentTimeProps{
    recentTimeLabel: string;
    recentlabelChecked: boolean;
}
```



#### 初始化——list

```typescript

```









### 父组件TimePicker

```typescript
const TimePicker: FC = () => {
	const [timeValue, setTimeValue] = useState<any>([]) //timeValue={[moment('2015/01/01'), moment('2015/01/01')]}
    
    return(
        <RangePicker
            value={timeValue}
            onChange={(selectedTimeValue) => setTimeValue(selectedTimeValue)} 
            renderExtraFooter={() =>
              <Fragment>
                <TimeZone />
                <RecentTime />
                <RelativeTime
                  setTimeValue={setTimeValue} 
                />
              </Fragment>
        }
        />
    )

}
```

